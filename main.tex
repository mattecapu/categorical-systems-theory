\documentclass[english]{paper}

\title{Notes on categorical systems theory}
\author{Matteo Capucci\\University of Strathclyde}
%\institution{University of Strathclyde}
% \email{matteo.capucci@strath.ac.uk}
% \address{Office 1310, Livingstone Tower, 26 Richmond St, Glasgow (UK)}

\addbibresource{./bibliography.bib}

\input{preamble.tex}
\input{local-preamble.tex}

\allowdisplaybreaks
\raggedbottom

\begin{document}
	\maketitle

	\section{Introduction}
	Systems are ubiquitous, in science as in life.
	%People regularly deal with physical systems, political systems, economical systems, living systems, learning systems, writing systems, voting systems, computing systems, etc.
	As we look into a thing, we soon realize it is a system comprised of smaller interacting parts,\footnote{Heck, even \emph{atoms}, indivisible par excellence, arise from many layers of interaction among their parts!}. As we walk back, we realize it is itself part of an even more complex system.

	The word `system' roughly means `composite thing in Greek.
	It seems therefore natural that category theory has something to say about them.

	% Given the staggering variety systems come in, it is no surprise scientific paradigms and mathematical models to describe them are manifold and often incompatible with one another.
	% Studying each of these paradigms by themselves is surely a useful endeavour, but the ethos of category theory is to adopt a formal, bird-eye view of disciplines, to find the common motifs. Hence in approaching the study of systems theory, the category theorist should ask: what are the formal structures underlying all the different approaches to systems?

	Categorical System Theory (CST) is a categorical framework for the abstract study of systems irrespective of their contingent aspects.
	%It studies any situation involving many parts engaging in some interesting behaviour.
	%
	Instead of espousing a specific paradigm on the mathematical specification of systems, CST predicates upon the general features such paradigms should have.
	In doing so, it captures the essence of the notion of `system'.

	The object of study of CST is thus a \emph{doctrine of systems}, which is defined in \cite{myers_categorical_2022} as way to answer the following questions:
	\begin{quote}
		\begin{itemize}
			\item What does it mean to be a system? Does it have a notion of states, or of behaviours? Or is it a diagram describing the way some primitive parts are organized?
			\item What should the interface of a system be?
			\item How can interfaces be connected in composition patterns?
			\item How are systems composed through composition patterns between their interfaces.
			\item What is a map between systems, and how does it affect their interfaces?
			\item When can maps between systems be composed along the same composition patterns as the systems.
		 \end{itemize}
	\end{quote}

	A doctrine of systems specializes in many different \emph{theories of systems}. For instance there is a doctrine of open dynamical systems encompassing the theory of deterministic dynamical systems, the theory of stochastic dynamical systems, the theory of differential dynamical systems, and many more.
	Hence it's usually easier to start describing what a theory of systems is and then to say what does it mean for a doctrine to gather many of them in a single object.

	\subsection{References}
	Categorical approaches to general system theory have been around for a long time.
	The earliest is probably~\cite{rosen1978fundamentals}, which deals with systems from an observational point of view. The work pioneers the idea of gathering systems in categories and considering their observable behaviour as input-output relations.

	In the 90s, a series of papers by Katis, Sabadini, Walters and others established a theory of machines \cite{sabadini_functions_1993, bloom_matrices_1996, katis1997bicategories, katis1997span, katis_algebra_1999, katis2002feedback} which anticipated some of the ideas regarding functorial semantics of behaviour, finding categories of matrices are well-adapted to receive such functors.

	The works on structured and decorated cospans \cite{fiadeiro2007structured,fong2015decorated, baez2020open,baez2020structured,Baez2022structuredversus} deals with the doctrine of port-plugging systems (circuits) in modern form, and started using some ideas from double category theory to talk about them.
	This also happens in \cite{lerman2018networks,culbertson2020formal}.

	In \cite{spivak2013operad, libkind2021operadic} and other related works the idea operads provide the syntax for composition of systems is introduced.

	Thus we can say that albeit the current form of CST (as the yoga of doubly indexed category and `copresheaves' over them) is due to David Jaz Myers, various pieces of this philosophy have been around for far longer, as well as specific incarnations of them.

	In this sense, we might be at the boundary between pre-paradigmatic phase and a period of normal science in the categorical study of systems.
	This is conditional on the ability of CST to establish itself as the dominant paradigm. In fact, the subject is still in its infancy.

	At the moment, most of CST lives in Myers' own book \cite{myers_categorical_2022}, itself a longer version of the shorter preprint \cite{myers_double_2020} (where the notion of \emph{doctrine} wasn't yet developed).
	Moreover, Myers has given a few talks about the topic in the past years:
	\begin{enumerate}
		\item \fullcite{myers2020talk1}
		\item \fullcite{myers2020talk2}
		\item \fullcite{myers2020act_talk}
		\item \fullcite{myers2021talk}
	\end{enumerate}
	I also gave a talk about CST and its extension to cybernetic systems:
	\begin{enumerate}[resume]
		\item \fullcite{capucci2022talk}
	\end{enumerate}

	\subsection{A quick tour of CST}
	Categorical systems theory is a conceptually simple, if mathematically sophisticated, framework.
	In a nutshell, it studies processes connecting systems, and the ways these behave. Processes are organized in (monoidal double) categories, which themselves index categories of systems, whose maps in (the observational theory of) sets are behaviours.

	If one is not at ease with double categories, at a first approximation one can drop the horizontal direction and think of these as monoidal categories of processes. They index sets of systems which can be reindexed by processes. One can study behaviour by specifying the set of ways interfaces can be observed, the relations processes induce between observations on their interfaces, and the states systems can be in and the observables these expose.

	However, none of the two dimensions in CST is ancillary to the other.
	The horizontal direction is often overlooked in pre-CST work, but it's extremely natural to consider: from a categorical standpoint, we study things (here, systems and processes) by looking at the way they map into each other.

	Thus the first step in CST is to understand \textbf{processes organize in monoidal double categories}:
	\begin{equation}
		\Processes := \left\{
			% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXGJ1bGxldCJdLFszLDAsIlxcYnVsbGV0Il0sWzAsMiwiXFxidWxsZXQiXSxbMywyLCJcXGJ1bGxldCJdLFswLDIsIlxcdGV4dHtwcm9jZXNzfSIsMV0sWzEsMywiXFx0ZXh0e3Byb2Nlc3N9IiwxXSxbMCwxLCJcXHRleHR7bWFwIG9mIGludGVyZmFjZXN9IiwxXSxbMiwzLCJcXHRleHR7bWFwIG9mIGludGVyZmFjZXN9IiwxXSxbNCw1LCJcXHRleHR7bWFwIG9mIHByb2Nlc3Nlc30iLDAseyJzaG9ydGVuIjp7InNvdXJjZSI6MjAsInRhcmdldCI6MjB9fV1d
			{\scriptstyle
			\begin{tikzcd}[ampersand replacement=\&, column sep=normal]
				\cdot \&\&\& \cdot \\
				\\
				\cdot \&\&\& \cdot
				\arrow[""{name=0, anchor=center, inner sep=0}, "{\text{process}}"{description}, from=1-1, to=3-1]
				\arrow[""{name=1, anchor=center, inner sep=0}, "{\text{process}}"{description}, from=1-4, to=3-4]
				\arrow["{\text{map of interfaces}}"{description}, from=1-1, to=1-4]
				\arrow["{\text{map of interfaces}}"{description}, from=3-1, to=3-4]
				\arrow["{\text{map of processes}}", shift right=1, shorten <=19pt, shorten >=19pt, Rightarrow, from=0, to=1]
			\end{tikzcd}}
		\right\}
	\end{equation}
	Such processes are actually `composition patterns' that can be used to weave systems together, i.e.~the ways parts can come together to form wholes. These can be wiring diagrams, or bubble diagrams, or circuit diagrams, etc. Both ways of thinking about them can be useful.

	Mathematically speaking, \textbf{processes index systems}, giving rise to doubly indexed categories called \textbf{systems theories}:
	\begin{equation}
		\Sys : \Processes^\top \unilaxto \dblCat
	\end{equation}
	Thus, and this is a fundamental idea in CST, systems and processes are formally distinguished, even though they might end up being quite similar. In fact, in many instances, systems are special instances of processes which are considered stateful.
	The categories of systems over a given interface are categories of structure-preserving morphisms of systems, which we call simulations here. These can be more or less rigid depending on the user's taste.

	Finally, systems are as interesting as the things they do.
	The observations we can make of a system are its behaviour. Ways to observe systems in a given theory are \textbf{theories of behaviour}, which are maps into the `observational theory':
	\begin{equation}
		% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXFByb2Nlc3Nlc15cXHRvcCJdLFswLDIsIlxcU3BhbihcXGNhdCBDKV5cXHRvcCJdLFsyLDEsIlxcZGJsQ2F0Il0sWzEsMF0sWzEsMl0sWzAsMSwiQl5cXHRvcCIsMl0sWzAsMiwiXFxTeXMiLDAseyJjdXJ2ZSI6LTF9XSxbMSwyLCJcXGNhdCBDLy0iLDIseyJjdXJ2ZSI6MX1dLFszLDQsIkJeXFxmbGF0IiwwLHsib2Zmc2V0Ijo1LCJzaG9ydGVuIjp7InNvdXJjZSI6MzAsInRhcmdldCI6MzB9LCJsZXZlbCI6Mn1dXQ==
		\begin{tikzcd}[ampersand replacement=\&, sep=small]
			{\Processes^\top} \& {} \\
			\&\& \dblCat \\
			{\dblSet^\top} \& {}
			\arrow["{B^\top}"', from=1-1, to=3-1]
			\arrow["\Sys", curve={height=-6pt}, from=1-1, to=2-3]
			\arrow["{\Set/-}"', curve={height=6pt}, from=3-1, to=2-3]
			\arrow["{B^\flat}"', shift right=4, shorten <=10pt, shorten >=15pt, Rightarrow, from=1-2, to=3-2]
		\end{tikzcd}
	\end{equation}
	Here $\dblSet$ is the double category of spans in $\Set$ and $\dblCat$ is the double category of functors and profunctors.

	\subsection{Prerequisites}
	CST is deeply rooted in double category theory. This is dictated by the structure of processes: they compose like morphisms but are also the subject of morphisms.

	For many notions, we will reference \cite{grandis_higher_2019}.
	For a slow paced, well-motivated introduction of the minimum double category theory used in CST, we invited the reader to read along the main reference \cite{myers_categorical_2022}.

	\section{Processes}
	The starting point for defining a theory of systems is defining a double category of composition patterns such systems use to interact with one another.
	In practice, defining the systems and defining the composition patterns are activities that influence one another. Systems are made out of composition patterns themselves, and it's usually them we have in mind when we approach a formalization problem. So one often starts by asking how the systems at hand could possibly be composed together.

	Composition patterns usually form an operad.\footnote{By `operad' we mean `coloured operad' which means `multicategory'.}
	Operads are indeed ways to specify how `small things fit into larger things', i.e.~they are \emph{theories of composition}. Most importantly, they give meaning to various kinds of wiring diagrams \cite{spivak2013operad,vagner2014algebras, libkind2021operadic}.

	One can also see composition patterns as \emph{processes} that extend a given system with further dynamics, possibly gathering many systems in one. This point of view can be more natural from a `European' point of view, more acquainted with string diagrams rather than wiring diagrams. In fact one can see double categories of composition patterns as higher-dimensional extensions of the process theories of Abramsky, Coecke, Gogioso \cite{abramsky2004categorical, coecke2018picturing}.

	\begin{definition}
		A \textbf{process theory} is a symmetric monoidal double category with attitude.
	\end{definition}

	Hence any monoidal double category can be a process theory if we have a convincing interpreation of it as such. In other words, at this level of generality there's no justification for limiting this definition further. Of course any specific doctrine of systems can make more opinionated choices on which monoidal double categories to admit, and we will see plenty of examples of this.

	\begin{remark}
		Rather than defining double categories of processes to be monoidal, one should arguably define them to be multicategories. Thus a nicer, if more exotic, definition of process theory would be that of a `multicategory internal to categories'.%\footnote{As opposite to virtual double categories, which are categories internal to multicategories.}
		This is the reason here, following the custom recently adopted by Myers, we often denote processes as having many inputs. With our definitions, one might interpret the notation $I_1, \ldots, I_n$ as denoting a monoidal product, i.e.~we denote with `$, $' the monoidal product on processes.
	\end{remark}

	A process theory $\Processes$ thus unpacks as follows:
	\begin{enumerate}
		\item There are a number of objects $I, J, K, \ldots$ which are \textbf{interfaces} of the processes.%, or the \textbf{boxes} of the composition patterns.
		\item There are horizontal maps $h: I \horto J$ which are \textbf{maps of interfaces}, without dynamic content, they simply compare different interfaces with each other.\footnote{One could call these `algebraic maps of interfaces', as their role is to provide morphisms that \emph{preserve} the interface structure, in order to compare them.}
		\begin{equation}
			% https://q.uiver.app/?q=WzAsMixbMCwwLCJJIl0sWzEsMCwiSiJdLFswLDEsImgiXV0=
			\begin{tikzcd}[ampersand replacement=\&]
				I \& J
				\arrow["h", from=1-1, to=1-2]
			\end{tikzcd}
		\end{equation}
		\item There are vertical maps $p : I_1, \ldots, I_n \verto K$  which are the \textbf{processes}, connecting interfaces in some way.\footnote{Again, one might call these `geometric maps of interfaces', as they \emph{reflect} structure in many example we care about}
		\begin{equation}
			% https://q.uiver.app/?q=WzAsMixbMCwwLCJJIl0sWzAsMSwiSyJdLFswLDEsInAiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJiYXJyZWQifX19XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				I_1, \ldots, I_n \\
				K
				\arrow["p"', "\bullet"{marking}, from=1-1, to=2-1]
			\end{tikzcd}
		\end{equation}
		\item There are squares $\alpha : p \twoto q$ which are \textbf{maps of processes} supported by given maps of interfaces:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNCxbMCwwLCJJIl0sWzAsMSwiSyJdLFsxLDAsIkoiXSxbMSwxLCJMIl0sWzAsMiwiaCJdLFswLDEsInAiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJiYXJyZWQifX19XSxbMSwzLCJrIiwyXSxbMiwzLCJxIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiYmFycmVkIn19fV0sWzUsNywiXFxhbHBoYSIsMCx7InNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH19XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{I_1, \ldots, I_n} \& {J_1, \ldots, J_n} \\
				K \& L
				\arrow["{h_1, \ldots,\, h_n}", from=1-1, to=1-2]
				\arrow[""{name=0, anchor=center, inner sep=0}, "p"', "\bullet"{marking}, from=1-1, to=2-1]
				\arrow["k"', from=2-1, to=2-2]
				\arrow[""{name=1, anchor=center, inner sep=0}, "q", "\bullet"{marking}, from=1-2, to=2-2]
				\arrow["\alpha", shorten <=15pt, shorten >=15pt, Rightarrow, from=0, to=1]
			\end{tikzcd}
		\end{equation}
	\end{enumerate}

	A very important takeway behind this definition is that it distinguishes morphisms \emph{as} processes from morphisms \emph{of} processes. In fact, the usual yoga of process theories (which amount to symmetric monoidal `single' categories) only focuses on the compositional properties of processes (they compose like morphisms). But in category theory we know that if we want to study something, we need to study morphisms between them!

	\begin{example}[Alphabets]
	\label{ex:alphabets}
		Let $\Alph = \FinSet^\uparrow$ be the double category of alphabets and alphabet reductions, and maps thereof. Its objects are finite sets of symbols we call `alphabets'. Its horizontal maps are maps of finite sets. Its vertical maps are \emph{alphabet reductions}, which are map of finite sets in the opposite direction:
		\begin{equation}
			p : \Sigma \verto \Sigma' \in \FinSet(\Sigma', \Sigma)
		\end{equation}
		Squares are commutative squares:
		\begin{equation}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXFNpZ21hIl0sWzAsMSwiXFxTaWdtYSciXSxbMSwwLCJcXFhpIl0sWzEsMSwiXFxYaSciXSxbMSwwLCJwIl0sWzMsMiwicSIsMl0sWzAsMiwiaCJdLFsxLDMsImsiLDJdXQ==
			\begin{tikzcd}[ampersand replacement=\&]
				\Sigma \& \Xi \\
				{\Sigma'} \& {\Xi'}
				\arrow["p", from=2-1, to=1-1]
				\arrow["q"', from=2-2, to=1-2]
				\arrow["h", from=1-1, to=1-2]
				\arrow["k"', from=2-1, to=2-2]
			\end{tikzcd}
		\end{equation}
	\end{example}

	\begin{example}[Bidirectional processes]
	\label{ex:lenses}
		Consider the following double category of \emph{deterministic bidirectional processes} $\dblLens$:
		\begin{enumerate}
			\item interfaces are given by pairs or sets $\lens{A^-}{A^+}$, whose monoidal product is given by componentwise product,
			\item processes $\lens{A^-}{A^+} \opticto \lens{C^-}{C^+}$ are given by \textbf{lenses} $\lens{f^\sharp}{f}$, comprised of a \emph{get part} $f : A^+ \to C^+$ and a \emph{put part} $f^\sharp : A^+ \times C^- \to A^-$,
			\item maps of interfaces $\lens{A^-}{A^+} \chartto \lens{B^-}{B^+}$ are given by \textbf{charts} $\lens{g^\flat}{g}$, comprised of a \emph{states part} $g : A^+ \to B^+$ and a \emph{directions part} $g^\flat : A^+ \times A^- \to B^-$,
			\item behaviours are given by arrangements
			\begin{equation}
			\label{eq:det-behav}
				% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXGxlbnN7QV4tfXtBXit9Il0sWzAsMSwiXFxsZW5ze0NeLX17Q14rfSJdLFsxLDEsIlxcbGVuc3tEXi19e0ReK30iXSxbMSwwLCJcXGxlbnN7Ql4tfXtCXit9Il0sWzAsMywiZyIsMix7Im9mZnNldCI6MX1dLFswLDEsImYiLDIseyJvZmZzZXQiOjF9XSxbMywyLCJrIiwyLHsib2Zmc2V0IjoxfV0sWzEsMiwiaCIsMix7Im9mZnNldCI6MX1dLFsxLDAsImZeXFxzaGFycCIsMix7Im9mZnNldCI6MX1dLFsyLDMsImteXFxzaGFycCIsMix7Im9mZnNldCI6MX1dLFswLDMsImdeXFxmbGF0IiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsImheXFxmbGF0IiwwLHsib2Zmc2V0IjotMX1dXQ==
				\begin{tikzcd}[ampersand replacement=\&]
					{\lens{A^-}{A^+}} \& {\lens{B^-}{B^+}} \\
					{\lens{C^-}{C^+}} \& {\lens{D^-}{D^+}}
					\arrow["g"', shift right=1, from=1-1, to=1-2]
					\arrow["f"', shift right=1, from=1-1, to=2-1]
					\arrow["k"', shift right=1, from=1-2, to=2-2]
					\arrow["h"', shift right=1, from=2-1, to=2-2]
					\arrow["{f^\sharp}"', shift right=1, from=2-1, to=1-1]
					\arrow["{k^\sharp}"', shift right=1, from=2-2, to=1-2]
					\arrow["{g^\flat}", shift left=1, from=1-1, to=1-2]
					\arrow["{h^\flat}", shift left=1, from=2-1, to=2-2]
				\end{tikzcd}
			\end{equation}
			such that for every $a^+ \in A^+$ and $c^- \in C^-$:
			\begin{eqalign}
				k(g(a^+)) &= h(f(a^+)),\\
				g^\flat(a^+, f^\sharp(a^+, c^-)) &= k^\sharp(g(a^+), h^\flat(f(a^+), c^-)).
			\end{eqalign}
		\end{enumerate}
		The last conditions are hard to parse formally, but basically they say that both squares one can spot in~\eqref{eq:det-behav} commute.
		Concretely, we have two bidirectional processes $\lens{f^\sharp}{f}$ and $\lens{k^\sharp}{k}$ and a way to map between their interfaces. We are then asking that their dynamics commute with such maps.
	\end{example}

	\begin{remark}
		Viewed as composition patterns, lenses are algebras of the operad of wiring diagrams \cite{spivak2013operad}. Thus they represent ways to wire a number of boxes into a larger box:
		\begin{figure}[H]
			\matteo{wiring diagram}
		\end{figure}
	\end{remark}

	\begin{example}
	\label{ex:f-lenses}
		The previous example can be generalized greatly by employing $F$-lenses~\cite{spivak_generalized_2019}. These are lenses in which the backward part is dependent on the forward part in a way specified by an indexed category $F$.
		Intuitively, this correspond to a wiring pattern which can change dependening on the what flows in the wires (see \cite{spivak_poly_2020}).

		The definitions of $F$-lenses and $F$-charts are substantially identical to the ones above, as well as that for the squares (except the `commutativity condition' is now harder to eyeball).
		We gather some examples here:
		\begin{center}
			\begin{tabular}{l|l|l}
				& \textbf{category} & $F$\\
				\hline
				\textbf{deterministic} & $\cat C$ cartesian monoidal & $\Set/_{\sf proj} -$ (or $\coKl(- \times =)$) \\
				\textbf{possibilistic} & $\cat E$ topos & $\biKl(- \times =, \pow)$ ($\pow$ powerset monad)\\
				\textbf{probabilistic} & $\Msbl$ & $\biKl(- \times =, \Delta)$ ($\Delta$ probability monad)\\
				\textbf{effectful} & $\cat C$ cartesian monoidal & $\biKl(- \times =, M)$ ($M$ commutative monad)\\
				\textbf{differential (Euclidean)} & $\Euc$ & $\Euc/_{\sf subm}-$\\
				\textbf{differential (general)} & $\Smooth$ & $\Smooth/_{\sf subm}-$
			\end{tabular}
		\end{center}
	\end{example}

	\begin{example}[Observational theory]
		Given any Cartesian category\footnote{By which we mean a category with a terminal object and all pullbacks.}
		spans \& maps
	\end{example}

	\section{Systems}
	Systems are the things processes link, or the things composition patterns compose.

	% In category theory, when we want to talk about things that `compose as' some syntax we have in mind, we talk about \emph{semantics} of this syntax. If this syntax is given as an operad, we talk about algebras thereof. If this syntax is given by a monoidal double category, we talk about \emph{actions} of it.

	% What `action of a monoidal double category' can be worked out by thinking of the latter as monads in spans of monoidal categories. The result is the following:

	\begin{definition}
		A \textbf{doubly indexed category}, or \textbf{action of a double category}, is given, informally, by a unitary lax double functor $\Sys : \Processes^\top \to \dblCat$.
		If $\Processes$ is monoidal, then we also ask $\Sys$ to be lax monoidal.
	\end{definition}

	We recall $\dblCat$ is the cartesian monoidal double category of categories, functors, profunctors and natural transformations. A unitary lax functor is a double functor preserving vertical identities strictly but not vertical composition. Hence given two maps of interfaces $h:I \to J$, $k : J \to K$, we have a natural transformation $\ell_{h,k}:\Sys(h) \otimes \Sys(k) \to \Sys(h \comp k)$ between profunctors.

	\begin{definition}
		A \textbf{theory of systems over the process theory $\Processes$} is a monoidal doubly indexed category $\Sys : \Processes^\top \to \dblCat$ with attitude.
	\end{definition}

	Concretely, $\Sys$ maps interfaces to \textbf{categories of systems}, processes to \textbf{extension functors}, maps of interfaces to \textbf{mapping profunctors} and maps of processes to \textbf{extension transformations}.

	Hence given an interface $I : \Processes$, we think of the objects of $\Sys(I)$ as systems of a certain kind while the maps are \textbf{simulations} between them, i.e.~some notion of structure-preserving map between them.
	\begin{equation}
		\Sys(I) = \left\{
			% https://q.uiver.app/?q=WzAsMixbMCwwLCJcXHN5cyBTIl0sWzIsMCwiXFxzeXMgVCJdLFswLDEsIlxcdmFycGhpIl1d
			\begin{tikzcd}[ampersand replacement=\&, sep=scriptsize]
				{\sys S} \& {\sys T}
				\arrow["\varphi", from=1-1, to=1-2]
			\end{tikzcd}
		\right\}
	\end{equation}
	The functors induced by a process act by extending a system with that process. If we think of the process as a composition pattern instead, the functor assembles in a composite system:
	\begin{equation}
		\Sys(I \nverto{p} K) : \Sys(I) \longto \Sys(K)
	\end{equation}
	The profunctors induced by a map of interfaces give notions of simulations between systems on different interfaces:
	\begin{equation}
		\Sys(I \nhorto{h} J) : \Sys(I) \profto \Sys(J)
	\end{equation}
	Hence an element $\ell \in \Sys(I \nhorto{h} J)(\sys S, \sys T)$ is a \emph{simulation of $\sys S$ in $\sys T$ mediated by the maps of interfaces $h$}.

	Finally, squares in $\Processes$ induce squares witnessing the extension of a simulation of systems along a map of processes:
	\begin{equation}
		\Sys(p \ntwoto{\alpha} q) : \Sys(h) \twoto (\Sys(p), \Sys(q))^*\Sys(k)
	\end{equation}

	\begin{example}[Closed dynamical systems]
	\label{ex:closed-dyn-sys}
		The most basic model of dynamical systems in mathematics is simply endomorphisms $\delta:S \to S$ on some space $S$ in a category of `spaces' $\cat S$.
		These systems are closed: they expose nothing of their state, and their dynamics can't be influenced by external input: their process theory is trivial!
		Consequently, the systems theory of closed dynamical systems is given by a single category $\DynSys_{\cat S}$:
		\begin{equation}
			\DynSys_{\cat S} : 1^\top \unilaxto \dblCat.
		\end{equation}
		In this category, the objects are endomorphisms and the maps are commuting squares of the form:
		\begin{equation}
			\begin{tikzcd}[ampersand replacement=\&]
				S \arrow[swap]{d}{\delta} \arrow{r}{\varphi} \& R \arrow{d}{\gamma}\\
				S \arrow{r}[swap]{\varphi} \& R
			\end{tikzcd}
		\end{equation}
		Clearly $\DynSys_{\cat S}$ is monoidal if $\cat S$ is.
		Thus given a category $\cat S$ of spaces, one gets a systems theory of \textbf{closed dynamical systems} in $\cat S$.
	\end{example}

	\begin{example}
	\label{ex:closed-dyn-sys-vars}
		There's many possible variations on the definition of $\DynSys_{\cat S}$. Two that encompass many interesting examples are as follows.
		\begin{enumerate}
			\item One can choose an endofunctor $F:\cat S \to \cat S$ and consider $F$-coalgebras instead of mere endomorphisms as the dynamical systems. In this way one can get, e.g.~non-deterministic closed systems. We denote this category $\Coalg(F)$. The basic case is recovered for the choice $F=1_{\cat S}$.
			\item One can choose a monoid of `time' $T$ and consider $T$-actions instead of mere endomorphisms. Notice one can pick $T : \Mon(\cat S)$ but also $T : \Mon(\Set)$, and then consider $T$-actions to be functors $BT \to \cat S$. In this way one can get, e.g.~continuous time dynamical systems by choosing $T=\R$. We denote this category $\cat{TimeSys}(T)$. The basic case is recovered for the choice $T = \N$.
		\end{enumerate}
		These two examples also admit a more interesting theory of processes, as we are going to see shortly.
	\end{example}

	\begin{example}
		We can think of a coalgebra $A \to FA$ as
		system with states $A$ and interface $F$. Now, natural transformations
		$\alpha : F \Rightarrow F'$ are `lenses' and one gets an indexed
		category
		\begin{equation}
			\Coalg : \End(\cat C) \to \Cat
		\end{equation}
		Now, if $\cat C$ is additionally finitely complete, we can go further
		and add another dimension. In fact, in this case, $\End(\cat C)$ is
		fibred over $\cat C$ by evaluation at the terminal object:
		\begin{equation}
			-(1) : \End(\cat C) \to C
		\end{equation}
		The cartesian lift of a given arrow $f:A \to G(1)$ is given by a
		natural transformation $f_G : f^*G \Rightarrow G$ obtained from the
		pullback square
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNCxbMSwwLCJHWCJdLFsxLDEsIkcxIl0sWzAsMSwiQSJdLFswLDAsImZeKkdYIl0sWzAsMSwiRyEiXSxbMiwxLCJmIiwyXSxbMywyXSxbMywwLCJmX3tHLFh9Il0sWzMsMSwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
			\begin{tikzcd}[ampersand replacement=\&]
				{f^*GX} \& GX \\
				A \& G1
				\arrow["{G!}", from=1-2, to=2-2]
				\arrow["f"', from=2-1, to=2-2]
				\arrow[from=1-1, to=2-1]
				\arrow["{f_{G,X}}", from=1-1, to=1-2]
				\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
			\end{tikzcd}
		\end{equation}
		that simultaneously defines $f^*G$ (on morphisms is defined by
		pullback again) and $f_G$.

		The fibred subcategory of polynomial functors is what gives
		`dependent' lenses, whose opposite is the codomain fibration,
		i.e.~`dependent' charts \cite{spivak_generalized_2019}.
		This suggests that taking the opposite fibration of $-(1)$ gives us a
		fibration of `generalized charts'.

		We can explicitly construct these things if we work out the cartesian
		factorization system induced by $-(1)$ on $\End(\cat C)$. This is
		given by

		\begin{enumerate}
			\item
				Cartesian maps are given by natural transformations whose naturality
				is witness by pullback squares, as suggested by the definition of
				$f^*G$ above: which we make explicit here:

				\begin{equation}
					% https://q.uiver.app/?q=WzAsNCxbMCwwLCJGWCJdLFsxLDAsIkdYIl0sWzEsMSwiR1kiXSxbMCwxLCJGWSJdLFszLDIsIlxcYWxwaGFfWSIsMl0sWzEsMiwiR2YiXSxbMCwxLCJcXGFscGhhX1giXSxbMCwzLCJGZiIsMl0sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
					\begin{tikzcd}[ampersand replacement=\&]
						FX \& GX \\
						FY \& GY
						\arrow["{\alpha_Y}"', from=2-1, to=2-2]
						\arrow["Gf", from=1-2, to=2-2]
						\arrow["{\alpha_X}", from=1-1, to=1-2]
						\arrow["Ff"', from=1-1, to=2-1]
						\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
					\end{tikzcd}
				\end{equation}
			\item
				Vertical maps are given by natural transformations whose component at
				$1$ is an isomorphism (think: the identity)
		\end{enumerate}

		We define a \emph{generalized chart} $\lens{k^\flat}{k}: F \chartto G$ to be a span in $\End(\cat C)$ whose left leg is vertical and whose right leg is cartesian. Hence they look like this:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsOCxbMSwxLCJGMSJdLFszLDEsIkcxIl0sWzMsMCwiRyJdLFsyLDEsIkYxIl0sWzIsMCwiZl4qRyJdLFsxLDAsIkYiXSxbMCwwLCJcXEVuZChcXGNhdCBDKSJdLFswLDEsIlxcY2F0IEMiXSxbNCwyLCJrX0ciXSxbMywxLCJrIiwyXSxbMCwzLCIiLDIseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDUsImteXFxmbGF0IiwyXSxbNiw3LCItKDEpIiwyXV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\End(\cat C)} \& F \& {f^*G} \& G \\
				{\cat C} \& F1 \& F1 \& G1
				\arrow["{k_G}", from=1-3, to=1-4]
				\arrow["k"', from=2-3, to=2-4]
				\arrow[Rightarrow, no head, from=2-2, to=2-3]
				\arrow["{k^\flat}"', from=1-3, to=1-2]
				\arrow["{-(1)}"', from=1-1, to=2-1]
			\end{tikzcd}
		\end{equation}
		These might look like lenses (because lenses are obtained by opping a
		fibration) but they are actually charts. We can verify this by looking
		at the case in which $F$ and $G$ are polynomial (over $\Set$), to see if this
		construction recovers the usual one. We see that $k^\flat$ lives in
		\begin{equation}
			\Nat\left(\sum_{i \in F1} y^{F_i}, \sum_{j \in F1} y^{G_{k(j)}}\right) \iso \prod_{i \in F1} \sum_{j \in F1} \Set(F_i, G_{k(j)})
		\end{equation}
		and since we know this is a vertical map, meaning it lives over the
		identity map of $F1$, we know $i=j$ on the right hand side. Thus we
		see $\lens{k^\flat}{k}$ encodes the data of a chart (notice how $F$ and
		$G$ swapped places: charts are lenses `relative to lenses').

		% Thus is not far-fetched to think of such a fibration as giving
		% generalized lenses and charts. What is sure is that the double
		% Grothendieck construction of David Jaz Myers gives us a double category
		% of endofunctors, natural transformations (loose), generalized charts
		% (tight) and commutative squares.

		This allows us to extend the indexed category $\Coalg$ defined
		previously to have a profunctorial action. So a given generalized chart
		$\lens{k^\flat}{k} : F \chartto G$ is mapped to a profunctor
		$\Coalg\lens{k^\flat}{k} : \Coalg(F) \profto \Coalg(G)$. This has a rather complex
		definition: it maps two coalgebras $\gamma:A \to FA$ and
		$\delta:B \to GB$ to the set of $\phi:A \to B$ that make the
		following commute:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsOCxbMCwwLCJBIl0sWzEsMiwia14qR0IiXSxbMCwyLCJGQSJdLFsxLDEsImteKkIiXSxbMiwxLCJCIl0sWzEsMywiRjEiXSxbMiwyLCJHQiJdLFsyLDMsIkcxIl0sWzAsMiwiXFxnYW1tYSIsMV0sWzMsMSwiXFxkZWx0YSciLDFdLFszLDQsImsnIiwxXSxbMCw0LCJcXHBoaSIsMSx7ImN1cnZlIjotMiwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzUsNywiayIsMV0sWzIsNSwiRiEiLDEseyJjdXJ2ZSI6Mn1dLFsxLDUsIkchJyIsMV0sWzQsNiwiXFxkZWx0YSIsMV0sWzMsNiwiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzYsNywiRyEiLDFdLFsxLDYsImtfe0csQn0iLDFdLFsxLDcsIiIsMix7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
			\begin{tikzcd}[ampersand replacement=\&]
				A \\
				\& {k^*B} \& B \\
				FA \& {k^*GB} \& GB \\
				\& F1 \& G1
				\arrow["\gamma"{description}, from=1-1, to=3-1]
				\arrow["{\delta'}"{description}, from=2-2, to=3-2]
				\arrow["{k'}"{description}, from=2-2, to=2-3]
				\arrow["\phi"{description}, curve={height=-12pt}, dashed, from=1-1, to=2-3]
				\arrow["k"{description}, from=4-2, to=4-3]
				\arrow["{F!}"{description}, curve={height=12pt}, from=3-1, to=4-2]
				\arrow["{G!'}"{description}, from=3-2, to=4-2]
				\arrow["\delta"{description}, from=2-3, to=3-3]
				\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
				\arrow["{G!}"{description}, from=3-3, to=4-3]
				\arrow["{k_{G,B}}"{description}, from=3-2, to=3-3]
				\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=3-2, to=4-3]
			\end{tikzcd}
		\end{equation}
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJBIl0sWzMsMSwia14qR0IiXSxbMCwxLCJGQSJdLFszLDAsImteKkIiXSxbMSwxLCJGQiJdLFswLDIsIlxcZ2FtbWEiLDJdLFszLDEsIlxcZGVsdGEnIiwxXSxbMCwzLCJcXGV4aXN0cyEgXFxsYW5nbGUgXFxnYW1tYSBcXGNvbXAgRiEsIFxccGhpIFxccmFuZ2xlIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZG90dGVkIn19fV0sWzEsNCwia15cXGZsYXRfQiIsMix7ImxhYmVsX3Bvc2l0aW9uIjozMH1dLFsyLDQsIkYoXFxwaGkpIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
			\begin{tikzcd}[ampersand replacement=\&]
				A \&\&\& {k^*B} \\
				FA \& FB \&\& {k^*GB}
				\arrow["\gamma"', from=1-1, to=2-1]
				\arrow["{\delta'}"{description}, from=1-4, to=2-4]
				\arrow["{\exists! \langle \gamma \comp F!, \phi \rangle}"{description}, dotted, from=1-1, to=1-4]
				\arrow["{k^\flat_B}"'{pos=0.3}, from=2-4, to=2-2]
				\arrow["{F(\phi)}", dashed, from=2-1, to=2-2]
			\end{tikzcd}
		\end{equation}
		% \begin{equation}
		% 	% https://q.uiver.app/?q=WzAsOSxbMCwwLCJBIl0sWzEsMiwiRkIiXSxbNCwwLCJCIl0sWzQsMiwiR0IiXSxbMywyLCJrXipHQiJdLFswLDIsIkZBIl0sWzMsMSwia14qQiJdLFszLDMsIkYxIl0sWzQsMywiRzEiXSxbMiwzLCJcXGRlbHRhIl0sWzQsMSwia15cXGZsYXRfQiIsMix7ImxhYmVsX3Bvc2l0aW9uIjozMH1dLFs1LDEsIkYoXFxwaGkpIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsNSwiXFxnYW1tYSIsMl0sWzYsMiwiayciXSxbNiw0LCJcXGRlbHRhJyIsMV0sWzYsMywiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzAsMiwiXFxwaGkiLDEseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCw2LCJcXGV4aXN0cyEgXFxsYW5nbGUgXFxnYW1tYSBcXGNvbXAgRiEsIFxccGhpIFxccmFuZ2xlIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZG90dGVkIn19fV0sWzMsOCwiRyEiXSxbNyw4LCJrIiwyXSxbNSw3LCJGISIsMix7ImN1cnZlIjoyfV0sWzQsNywiRyEnIiwyXSxbNCw4LCIiLDIseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XSxbNCwzLCJrX3tHLEJ9Il1d
		% 	\begin{tikzcd}[ampersand replacement=\&]
		% 		A \&\&\&\& B \\
		% 		\&\&\& {k^*B} \\
		% 		FA \& FB \&\& {k^*GB} \& GB \\
		% 		\&\&\& F1 \& G1
		% 		\arrow["\delta", from=1-5, to=3-5]
		% 		\arrow["{k^\flat_B}"'{pos=0.3}, from=3-4, to=3-2]
		% 		\arrow["{F(\phi)}", dashed, from=3-1, to=3-2]
		% 		\arrow["\gamma"', from=1-1, to=3-1]
		% 		\arrow["{k'}", from=2-4, to=1-5]
		% 		\arrow["{\delta'}"{description}, from=2-4, to=3-4]
		% 		\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-4, to=3-5]
		% 		\arrow["\phi"{description}, dashed, from=1-1, to=1-5]
		% 		\arrow["{\exists! \langle \gamma \comp F!, \phi \rangle}"{description}, dotted, from=1-1, to=2-4]
		% 		\arrow["{G!}", from=3-5, to=4-5]
		% 		\arrow["k"', from=4-4, to=4-5]
		% 		\arrow["{F!}"', curve={height=12pt}, from=3-1, to=4-4]
		% 		\arrow["{G!'}"', from=3-4, to=4-4]
		% 		\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=3-4, to=4-5]
		% 		\arrow["{k_{G,B}}", from=3-4, to=3-5]
		% 	\end{tikzcd}
		% \end{equation}

		Specifically, we are asking for the following:
		\begin{eqalign}
			\forall a \in A,&\quad G!(\delta(\phi(a))) = k(F!(\gamma(a)))\\
			\forall a \in A,&\quad k^\flat_B(\delta'(F!(\gamma(a)), \phi(a))) = F(\phi)(\gamma(a))
		\end{eqalign}
	\end{example}

	\begin{example}[Monoid actions]
		The categories $\cat{TimeSys}(T)$ naturally gather in a doubly indexed category where the indexing double category is $\Mon(\cat S)^\uparrow$. This is the double category of monoids in $\cat S$ and commutative squares thereof, except we take the opposite of the vertical direction. Hence a vertical morphism $p : M \verto N$ corresponds to a morphism of monoids $N \to M$.

		This double category is a process theory for the theory of dynamical systems `with time' described above. In fact a vertical morphism $p : M \verto N$ maps to a functor $\cat{TimeSys}(M) \to \cat{TimeSys}(N)$ given by `restriction of scalars':
		\begin{equation}
			M \times S \nto{\delta} S \qquad\longmapsto\qquad N \times S \nto{p \times S} M \times S \nto{\delta} S,
		\end{equation}
		and maps of monoids $h : M \to N$ also map to profunctors $\cat{TimeSys}(M) \profto \cat{TimeSys}(N)$ that sends a pair of dynamical systems $S : \cat{TimeSys}(M)$, $R:\cat{TimeSys}(N)$ to the set of squares
		\begin{equation}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJNIFxcdGltZXMgWCJdLFsyLDAsIk4gXFx0aW1lcyBZIl0sWzAsMSwiWCJdLFsyLDEsIlkiXSxbMCwyLCJTIiwyXSxbMSwzLCJSIl0sWzIsMywiXFx2YXJwaGkiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCwxLCJoIFxcdGltZXMgXFx2YXJwaGkiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{M \times S} \&\& {N \times R} \\
				S \&\& R
				\arrow["\delta"', from=1-1, to=2-1]
				\arrow["\gamma", from=1-3, to=2-3]
				\arrow["\varphi"', dashed, from=2-1, to=2-3]
				\arrow["{h \times \varphi}", dashed, from=1-1, to=1-3]
			\end{tikzcd}
		\end{equation}
	\end{example}

	\begin{example}[Labelled transition systems]
	\label{ex:trans-sys}
		We can use the double category $\Alph$ of alphabets defined in~\cref{ex:alphabets} to index labelled transition systems.
		When $T = \Sigma^*$ (the free monoid on a finite set $\Sigma$), then $\DynSys_{\cat S}(\Sigma^*)$ is the category of transition systems labelled in $\Sigma$.
		Hence we define $\cat{LabTransSys} : \dblcat{Alpha}^\top \unilaxto \dblCat$ by restricting $\DynSys_{\Set}$ along the double functor $(-)^* : \Mon^\uparrow \to \Alph$ given by taking free monoids.
	\end{example}

	\begin{example}[Finite state machines]
	\label{ex:fsm}
		A finite states machine with alphabet $\Sigma : \FinSet$ is a finite set $S$ of \emph{states} equipped with a \emph{transition function} $\delta : S \times \Sigma \to S$ and a subset $S^* \subseteq S$ of \emph{accepting states}.
		In other words, it's a labelled transition system with alphabet $\Sigma$ equipped with a predicate $S^*$ over $S$. These form a systems theory over $\Alph$, which mostly behaves like $\cat{LabTransSys}$. The only substiantal difference is that morphisms of finite states machines are given by commutative squares like
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNixbMCwwLCJTIFxcdGltZXMgXFxTaWdtYSJdLFswLDEsIlMiXSxbMiwwLCJSIFxcdGltZXMgXFxTaWdtYSJdLFsyLDEsIlIiXSxbMCwyLCJTXioiXSxbMiwyLCJSXioiXSxbMCwxLCJcXGRlbHRhIiwyXSxbMiwzLCJcXGdhbW1hIl0sWzAsMiwiXFx2YXJwaGkiXSxbMSwzLCJcXHZhcnBoaSIsMl0sWzQsMSwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs1LDMsIlxcc3Vic2V0ZXEiLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbNCw1LCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
			\begin{tikzcd}[ampersand replacement=\&]
				{S \times \Sigma} \&\& {R \times \Sigma} \\
				S \&\& R \\[-2.5ex]
				{S^*} \&\& {R^*}\\[-6ex]
				\arrow["\delta"', from=1-1, to=2-1]
				\arrow["\gamma", from=1-3, to=2-3]
				\arrow["\varphi", from=1-1, to=1-3]
				\arrow["\varphi"', from=2-1, to=2-3]
				\arrow["\subseteq"{marking}, draw=none, from=3-1, to=2-1]
				\arrow["\subseteq"{marking}, draw=none, from=3-3, to=2-3]
				\arrow["\subseteq"{marking}, draw=none, from=3-1, to=3-3]
			\end{tikzcd}
		\end{equation}
		where the commutativity of the bottom square means $\varphi(S^*) \subseteq R^*$.

		Thus there is a theory of systems, the \textbf{theory of finite states machines}
		\begin{equation}
			\FSM : \Alph^\top \unilaxto \dblCat.
		\end{equation}
	\end{example}

	\begin{remark}
		Often FSMs are assumed to be equipped with an initial state too. Adding this data to the previous definition is straightforward, but we think doing so is less elegant: there's quite a bit of elegance in the theory of FSMs without a specified initial state.
	\end{remark}

	% \begin{example}
	% 	One can enrich the theory of closed dynamical systems by exposing the states of a system by default (which is what is implicitly done most of the time).
	% 	Hence we can now define a process theory, actually many process theories, acting on this kind of systems. Given a system $S:X \to X$ in $\DynSys_{\cat S}$, we can't just have processes to be maps of $\cat S$ since we can't compose them with endomorphisms and get endomorphisms again.
	% 	Thus the most basic is the process theory of \emph{monomorphic adapters}, which are pairs of morphisms going back and forth.
	% 	We define a process theory $\dblcat{Adap}$ where:
	% 	\begin{enumerate}
	% 		\item interfaces are the objects of $\cat S$,
	% 		\item maps of interfaces are pairs of maps $(h,h^\flat) : I \to J$ of $\cat S$ both going from $I$ to $J$,
	% 		\item processes are monomorphic adapters: a process $(p, p^\sharp) : I \to J$ is a a pair of maps $p : I \to J$ and $p^\sharp : J \to I$,
	% 		\item squares are commutative squares arrangements of maps of interfaces and processes such that the squares induced by both parts commute.
	% 	\end{enumerate}
	% 	The monoidal structure is given by componentwise product.
	% 	$\dblcat{Adap}$ indexes endomorphisms: given $X: \dblcat{Adap}$, the category $\DynSys(X)$ is the category of endomorphisms of $X$ and commutative squares between them. An adapter $(p,p^\sharp) : X \to Y$ induces a functor $\DynSys(p,p^\sharp) : \DynSys(X) \to \DynSys(Y)$ mapping a dynamical systems $S:X \to X$ to $p^\sharp \comp S \comp p : Y \to Y$.
	% 	Instead, a pair of maps $(h,h^\flat):X \to Y$ induces a profunctor $\DynSys(h,h^\flat) : \DynSys(X) \profto \DynSys(Y)$ mapping a pair of endomorphisms $(S:X\to X,R:Y \to Y)$ to the set of squares:
	% 	\begin{eqalign}
	% 		\DynSys(h,h^\flat) : \DynSys(X)^\op \times \DynSys(Y) &\longto \Set\\
	% 		S:X\to X,R:Y \to Y) &\longmapsto
	% 			\left\{
	% 			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJYIl0sWzAsMSwiWCJdLFsxLDAsIlkiXSxbMSwxLCJZIl0sWzEsMywiaF5cXGZsYXQiLDAseyJvZmZzZXQiOi0xfV0sWzEsMywiaCIsMix7Im9mZnNldCI6MX1dLFswLDEsIlMiLDIseyJvZmZzZXQiOjF9XSxbMSwwLCJTIiwyLHsib2Zmc2V0IjoxfV0sWzIsMywiUiIsMix7Im9mZnNldCI6MX1dLFszLDIsIlIiLDIseyJvZmZzZXQiOjF9XSxbMCwyLCIiLDEseyJvZmZzZXQiOi0xLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMCwyLCIiLDEseyJvZmZzZXQiOjEsInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
	% 			\begin{tikzcd}[ampersand replacement=\&]
	% 				X \& Y \\
	% 				X \& Y
	% 				\arrow["{h^\flat}", shift left=1, from=2-1, to=2-2]
	% 				\arrow["h"', shift right=1, from=2-1, to=2-2]
	% 				\arrow["S"', shift right=1, from=1-1, to=2-1]
	% 				\arrow["S"', shift right=1, from=2-1, to=1-1]
	% 				\arrow["R"', shift right=1, from=1-2, to=2-2]
	% 				\arrow["R"', shift right=1, from=2-2, to=1-2]
	% 				\arrow[shift left=1, dashed, from=1-1, to=1-2]
	% 				\arrow[shift right=1, dashed, from=1-1, to=1-2]
	% 			\end{tikzcd}
	% 			\right\}
	% 	\end{eqalign}
	% \end{example}

	\begin{example}[Moore machines]
		Moore machines are open dynamical systems. Myers spends a long time developing their theory in~\cite{myers_categorical_2022}. In fact a very large class of systems is captured by Moore machines, especially in the extended form Myers considers.

		`Classical' Moore machines have a set of states $S$, a set of inputs $I$, a set of outputs $O$, and two maps $\expose : S \to O$ and $\update : S \times I \to S$. Hence they are given by lenses of the form $\lens{S}{S} \opticto \lens{I}{O}$. The special form of the left boundary is what makes them system-y: we guarantee statefulness of by guaranteeing the two `$S$' on the left are the same. We do so by defining maps of Moore machines (over a fixed interface $\lens{I}{O}$) to be squares in $\dblLens$ (\cref{ex:lenses}) of the form:
		\begin{equation}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXGxlbnN7U317U30iXSxbMCwyLCJcXGxlbnN7SX17T30iXSxbMiwyLCJcXGxlbnN7SX17T30iXSxbMiwwLCJcXGxlbnN7Un17Un0iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDAseyJvZmZzZXQiOi0xfV0sWzEsMCwiXFx1cGRhdGVfe1xcc3lzIFN9IiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsIiIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDEsIiIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFszLDIsIlxcZXhwb3NlX3tcXHN5cyBSfSIsMCx7Im9mZnNldCI6LTF9XSxbMiwzLCJcXHVwZGF0ZV97XFxzeXMgUn0iLDAseyJvZmZzZXQiOi0xfV0sWzAsMywiZyIsMix7Im9mZnNldCI6MX1dLFswLDMsIlxccGlfMiBcXGNvbXAgZyIsMCx7Im9mZnNldCI6LTF9XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{S}{S}} \&\& {\lens{R}{R}} \\[-2ex]
				\\[-2ex]
				{\lens{I}{O}} \&\& {\lens{I}{O}}
				\arrow["{\expose_{\sys S}}", shift left=1, from=1-1, to=3-1]
				\arrow["{\update_{\sys S}}", shift left=1, from=3-1, to=1-1]
				\arrow[shift right=1, no head, from=3-1, to=3-3]
				\arrow[shift right=1, no head, from=3-3, to=3-1]
				\arrow["{\expose_{\sys R}}", shift left=1, from=1-3, to=3-3]
				\arrow["{\update_{\sys R}}", shift left=1, from=3-3, to=1-3]
				\arrow["\varphi"', shift right=1, from=1-1, to=1-3]
				\arrow["{\pi_2 \comp \varphi}", shift left=1, from=1-1, to=1-3]
			\end{tikzcd}
		\end{equation}
		Notice the special form of the top chart: the map $\varphi : S \to R$ is used both on the bottom and on top. The fact maps of Moore machines cannot distinguish between top and bottom is the reason that boundary behaves as a stateful interface.

		The `generalized' Moore machines of Myers are obtained by passing from lenses to $F$-lenses. This testifies an important conceptual shift.

		Fix a category $\cat C$ and an indexed category $F: \cat C^\op \to \Cat$.
		First of all, $F$-lenses are now bidirectional morphisms that have some kind of mode-dependence: an object $\lens{I}{O}$ in $\dblLens_F$ is given by an object $O: \cat C$ and an object $I : F(O)$. This can be thought as a type dependent on $O$ or as a bundle over $O$. The important thing is that we introduce a more elaborate (and thus expressive) model of bidirectionality: stuff happens in the forward/bottom part (given by a morphism in $\cat C$), and then, \emph{depending on what happened there}, something else happens in the backward/top part. The difference can be substantial, to the point of having completely different types involved.

		In generalized Moore machines, we use this added dependency to distinguish between \emph{states} and \emph{state changes}. We thus think of the two $S$s in $\lens{S}{S}$ as playing different roles: the bottom one is a proper object of states, whereas the top one is actually more accurately represented by something like $TS : F(S)$, an object `over' $S$ (hence depending on $S$, varying with it) accounting for the possible changes in state.

		Hence whereas in a classical Moore machines all states are potentially reachable from any other states, we now contemplate machines in which the way we change state can be more complex. For example, we might choose a distribution of new states, or allow transitions only to states `nearby' in some sense (thus introducing geometric structure on $S$).

		Still, we want to be coherent in our meaning of `change'. Hence we parametrize theories of generalized Moore machines by a section $T: \cat C \to \int F$ picking out uniformly, for each $S: \cat C$, an object of changes $\lens{TS}{S}$ over it. Importantly, $T$ also maps morphisms $\varphi : S \to R$ to morphisms of changes $\lens{T\varphi}{\varphi} : \lens{TS}{S} \to \lens{TR}{R}$ (which we can think of as some kind of derivative). In this way we preserve the statefulness of the boundary.

		Thus a theory of Moore machines is constructed as follows. Chosen $\cat C : \Cat$ monoidal, $F: \cat C^\op \to \Cat$ lax monoidal and $T:\cat C \to \int F$ lax monoidal section, we first build the process theory $\dblLens_F$ of $F$-lenses and $F$-charts.
		Then, we define, for each $\lens{I}{O} : \dblLens_F$, the categories
		\begin{equation}
			\Moore_{(F,T)}\lens{I}{O} =
			\left\{
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXGxlbnN7U317U30iXSxbMCwyLCJcXGxlbnN7SX17T30iXSxbMiwyLCJcXGxlbnN7SX17T30iXSxbMiwwLCJcXGxlbnN7Un17Un0iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDAseyJvZmZzZXQiOi0xfV0sWzEsMCwiXFx1cGRhdGVfe1xcc3lzIFN9IiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsIiIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyLDEsIiIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFszLDIsIlxcZXhwb3NlX3tcXHN5cyBSfSIsMCx7Im9mZnNldCI6LTF9XSxbMiwzLCJcXHVwZGF0ZV97XFxzeXMgUn0iLDAseyJvZmZzZXQiOi0xfV0sWzAsMywiZyIsMix7Im9mZnNldCI6MX1dLFswLDMsIlxccGlfMiBcXGNvbXAgZyIsMCx7Im9mZnNldCI6LTF9XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{TS}{S}} \&\& {\lens{R}{R}} \\[-2ex]
				\\[-2ex]
				{\lens{I}{O}} \&\& {\lens{I}{O}}
				\arrow["{\expose_{\sys S}}", shift left=1, from=1-1, to=3-1]
				\arrow["{\update_{\sys S}}", shift left=1, from=3-1, to=1-1]
				\arrow[shift right=1, no head, from=3-1, to=3-3]
				\arrow[shift right=1, no head, from=3-3, to=3-1]
				\arrow["{\expose_{\sys R}}", shift left=1, from=1-3, to=3-3]
				\arrow["{\update_{\sys R}}", shift left=1, from=3-3, to=1-3]
				\arrow["g"', shift right=1, from=1-1, to=1-3]
				\arrow["{T\varphi}", shift left=1, from=1-1, to=1-3]
			\end{tikzcd}
			%\right.
			\right\}
		\end{equation}
		Given an $F$-lens $\lens{p^\sharp}{p} : \lens{I}{O} \chartto \lens{J}{Q}$ we get a functor:
		\begin{eqalign}
			\Moore_{(F,T)}\lens{p^\sharp}{p} : \Moore_{(F,T)}\lens{I}{O} &\longto \Moore_{(F,T)}\lens{J}{Q}\\
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsMixbMCwwLCJcXGxlbnN7VFN9e1N9Il0sWzAsMiwiXFxsZW5ze0l9e099Il0sWzAsMSwiXFxleHBvc2Vfe1xcc3lzIFN9IiwyLHsibGFiZWxfcG9zaXRpb24iOjYwLCJvZmZzZXQiOjF9XSxbMSwwLCJcXHVwZGF0ZV97XFxzeXMgU30iLDIseyJsYWJlbF9wb3NpdGlvbiI6NjAsIm9mZnNldCI6MX1dXQ==
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{TS}{S}} \\
				\\
				{\lens{I}{O}}
				\arrow["{\expose_{\sys S}}"'{pos=0.6}, shift right=1, from=1-1, to=3-1]
				\arrow["{\update_{\sys S}}"'{pos=0.6}, shift right=1, from=3-1, to=1-1]
			\end{tikzcd}
			&\longmapsto
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsMyxbMCwwLCJcXGxlbnN7VFN9e1N9Il0sWzAsMSwiXFxsZW5ze0l9e099Il0sWzAsMiwiXFxsZW5ze0p9e1F9Il0sWzAsMSwiXFxleHBvc2Vfe1xcc3lzIFN9IiwyLHsibGFiZWxfcG9zaXRpb24iOjYwLCJvZmZzZXQiOjF9XSxbMSwwLCJcXHVwZGF0ZV97XFxzeXMgU30iLDIseyJsYWJlbF9wb3NpdGlvbiI6NjAsIm9mZnNldCI6MX1dLFsxLDIsInAiLDIseyJvZmZzZXQiOjF9XSxbMiwxLCJwXlxcc2hhcnAiLDIseyJvZmZzZXQiOjF9XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{TS}{S}} \\
				{\lens{I}{O}} \\
				{\lens{J}{Q}}
				\arrow["{\expose_{\sys S}}"'{pos=0.6}, shift right=1, from=1-1, to=2-1]
				\arrow["{\update_{\sys S}}"'{pos=0.6}, shift right=1, from=2-1, to=1-1]
				\arrow["p"', shift right=1, from=2-1, to=3-1]
				\arrow["{p^\sharp}"', shift right=1, from=3-1, to=2-1]
			\end{tikzcd}
		\end{eqalign}
		Given an $F$-chart $\lens{h^\flat}{h} : \lens{I}{O} \chartto \lens{J}{Q}$, the induced profunctor is
		\begin{eqalign}
			\begin{tikzcd}[ampersand replacement=\&, sep=24ex]
				\Moore_{(F,T)}\lens{I}{O}^\op \times \Moore_{(F,T)}\lens{J}{Q} \arrow{r}{\Moore_{(F,T)}\lens{h^\flat}{h}} \& \Set
			\end{tikzcd}\hspace*{17ex}\\
			%\left(
				% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsMixbMCwwLCJcXGxlbnN7U317U30iXSxbMCwyLCJcXGxlbnN7SX17T30iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDAseyJvZmZzZXQiOi0xfV0sWzEsMCwiXFx1cGRhdGVfe1xcc3lzIFN9IiwwLHsib2Zmc2V0IjotMX1dXQ==
				\begin{tikzcd}[ampersand replacement=\&]
					{\lens{TS}{S}} \\
					\\
					{\lens{I}{O}}
					\arrow["{\expose_{\sys S}}"{pos=0.4}, shift left=1, from=1-1, to=3-1]
					\arrow["{\update_{\sys S}}"{pos=0.4}, shift left=1, from=3-1, to=1-1]
				\end{tikzcd},
				\ % file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsMixbMCwwLCJcXGxlbnN7U317U30iXSxbMCwyLCJcXGxlbnN7SX17T30iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDAseyJvZmZzZXQiOi0xfV0sWzEsMCwiXFx1cGRhdGVfe1xcc3lzIFN9IiwwLHsib2Zmc2V0IjotMX1dXQ==
				\begin{tikzcd}[ampersand replacement=\&]
					{\lens{TR}{R}} \\
					\\
					{\lens{J}{Q}}
					\arrow["{\expose_{\sys R}}"{pos=0.4}, shift left=1, from=1-1, to=3-1]
					\arrow["{\update_{\sys R}}"{pos=0.4}, shift left=1, from=3-1, to=1-1]
				\end{tikzcd}
			%\right)
			\longmapsto
			\left\{
				% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXGxlbnN7U317U30iXSxbMCwyLCJcXGxlbnN7SX17T30iXSxbMiwwLCJcXGxlbnN7Un17Un0iXSxbMiwyLCJcXGxlbnN7Sn17UX0iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDAseyJvZmZzZXQiOi0xfV0sWzEsMCwiXFx1cGRhdGVfe1xcc3lzIFN9IiwwLHsib2Zmc2V0IjotMX1dLFsyLDMsIlxcZXhwb3NlX3tcXHN5cyBSfSIsMCx7Im9mZnNldCI6LTF9XSxbMywyLCJcXHVwZGF0ZV97XFxzeXMgUn0iLDAseyJvZmZzZXQiOi0xfV0sWzEsMywiayIsMix7Im9mZnNldCI6MX1dLFsxLDMsImsiLDAseyJvZmZzZXQiOi0xfV0sWzAsMiwiaCIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsMiwiXFxwaV8yIFxcY29tcCBoIiwwLHsib2Zmc2V0IjotMSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
				\begin{tikzcd}[ampersand replacement=\&]
					{\lens{TS}{S}} \&\& {\lens{TR}{R}} \\
					\\
					{\lens{I}{O}} \&\& {\lens{J}{Q}}
					\arrow["{\expose_{\sys S}}"{pos=0.4}, shift left=1, from=1-1, to=3-1]
					\arrow["{\update_{\sys S}}"{pos=0.4}, shift left=1, from=3-1, to=1-1]
					\arrow["{\expose_{\sys R}}"{pos=0.4}, shift left=1, from=1-3, to=3-3]
					\arrow["{\update_{\sys R}}"{pos=0.4}, shift left=1, from=3-3, to=1-3]
					\arrow["h"', shift right=1, from=3-1, to=3-3]
					\arrow["h^\flat", shift left=1, from=3-1, to=3-3]
					\arrow["\varphi"', shift right=1, dashed, from=1-1, to=1-3]
					\arrow["{T\varphi}", shift left=1, dashed, from=1-1, to=1-3]
				\end{tikzcd}
			\right\}
		\end{eqalign}
		Finally, given a square
		\begin{equation}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXGxlbnN7QV4tfXtBXit9Il0sWzAsMSwiXFxsZW5ze0JeLX17Ql4rfSJdLFsxLDEsIlxcbGVuc3tEXi19e0ReK30iXSxbMSwwLCJcXGxlbnN7Q14tfXtDXit9Il0sWzAsMywiaCIsMix7Im9mZnNldCI6MX1dLFswLDEsInAiLDAseyJvZmZzZXQiOi0xfV0sWzMsMiwicSIsMCx7Im9mZnNldCI6LTF9XSxbMSwyLCJrIiwyLHsib2Zmc2V0IjoxfV0sWzEsMCwicF5cXHNoYXJwIiwwLHsib2Zmc2V0IjotMX1dLFsyLDMsInFeXFxzaGFycCIsMCx7Im9mZnNldCI6LTF9XSxbMCwzLCJoXlxcZmxhdCIsMCx7Im9mZnNldCI6LTF9XSxbMSwyLCJrXlxcZmxhdCIsMCx7Im9mZnNldCI6LTF9XV0=
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\lens{I}{O}} \& {\lens{J}{Q}} \\[2ex]
				{\lens{I'}{O'}} \& {\lens{J'}{Q'}}
				\arrow["h"', shift right=1, from=1-1, to=1-2]
				\arrow["p", shift left=1, from=1-1, to=2-1]
				\arrow["q", shift left=1, from=1-2, to=2-2]
				\arrow["k"', shift right=1, from=2-1, to=2-2]
				\arrow["{p^\sharp}", shift left=1, from=2-1, to=1-1]
				\arrow["{q^\sharp}", shift left=1, from=2-2, to=1-2]
				\arrow["{h^\flat}", shift left=1, from=1-1, to=1-2]
				\arrow["{k^\flat}", shift left=1, from=2-1, to=2-2]
			\end{tikzcd}
		\end{equation}
		in $\dblLens_F$ we get a square in $\dblCat$...
		\begin{equation}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNCxbMCwwLCJcXE1vb3JlXFxsZW5ze0FeLX17QV4rfSJdLFsyLDAsIlxcTW9vcmVcXGxlbnN7Ql4tfXtCXit9Il0sWzIsMiwiXFxNb29yZVxcbGVuc3tEXi19e0ReK30iXSxbMCwyLCJcXE1vb3JlXFxsZW5ze0NeLX17Q14rfSJdLFswLDMsIlxcTW9vcmVcXGxlbnN7aF5cXGZsYXR9e2h9IiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiYmFycmVkIn19fV0sWzAsMSwiXFxNb29yZVxcbGVuc3twXlxcc2hhcnB9e3B9Il0sWzMsMiwiXFxNb29yZVxcbGVuc3txXlxcc2hhcnB9e3F9IiwyXSxbMSwyLCJcXE1vb3JlXFxsZW5ze2teXFxmbGF0fXtrfSIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImJhcnJlZCJ9fX1dLFs0LDcsIlxcTW9vcmUoXFxzcXVhcmUpIiwwLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwLCJ0YXJnZXQiOjIwfX1dXQ==
			\begin{tikzcd}[ampersand replacement=\&]
				{\Moore\lens{I}{O}} \&\& {\Moore\lens{I'}{O'}} \\
				\\
				{\Moore\lens{J}{Q}} \&\& {\Moore\lens{J'}{Q'}}
				\arrow[""{name=0, anchor=center, inner sep=0}, "{\Moore\lens{h^\flat}{h}}"', "\shortmid"{marking}, from=1-1, to=3-1]
				\arrow["{\Moore\lens{p^\sharp}{p}}", from=1-1, to=1-3]
				\arrow["{\Moore\lens{q^\sharp}{q}}"', from=3-1, to=3-3]
				\arrow[""{name=1, anchor=center, inner sep=0}, "{\Moore\lens{k^\flat}{k}}", "\shortmid"{marking}, from=1-3, to=3-3]
				\arrow["{\Moore(\square)}", shorten <=23pt, shorten >=23pt, Rightarrow, from=0, to=1]
			\end{tikzcd}
		\end{equation}
		...given by stacking squares:
		\begin{eqalign}
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsMixbMCwwLCJcXE1vb3JlXFxsZW5ze2heXFxmbGF0fXtofShcXHN5cyBTLFxcc3lzIFIpIl0sWzIsMCwiXFxNb29yZVxcbGVuc3toXlxcZmxhdH17aH1cXGxlZnQoXFxNb29yZVxcbGVuc3twXlxcc2hhcnB9e3B9KFxcc3lzIFMpLFxcTW9vcmVcXGxlbnN7cV5cXHNoYXJwfXtxfShcXHN5cyBSKVxccmlnaHQpIl0sWzAsMSwiXFxNb29yZShcXHNxdWFyZSlfe1xcc3lzIFMsIFxcc3lzIFJ9Il1d
			\begin{tikzcd}[ampersand replacement=\&]
				{\Moore\lens{h^\flat}{h}(\sys S,\sys R)} \&\& {\Moore\lens{h^\flat}{h}\left(\Moore\lens{p^\sharp}{p}(\sys S),\Moore\lens{q^\sharp}{q}(\sys R)\right)}
				\arrow["{\Moore(\square)_{\sys S, \sys R}}", from=1-1, to=1-3]
			\end{tikzcd}\\
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{TS}{S}} \&\& {\lens{TR}{R}} \\
				\\
				{\lens{I}{O}} \&\& {\lens{J}{Q}}
				\arrow["{\expose_{\sys S}}"{pos=0.4}, shift left=1, from=1-1, to=3-1]
				\arrow["{\update_{\sys S}}"{pos=0.4}, shift left=1, from=3-1, to=1-1]
				\arrow["{\expose_{\sys R}}"{pos=0.4}, shift left=1, from=1-3, to=3-3]
				\arrow["{\update_{\sys R}}"{pos=0.4}, shift left=1, from=3-3, to=1-3]
				\arrow["h"', shift right=1, from=3-1, to=3-3]
				\arrow["h^\flat", shift left=1, from=3-1, to=3-3]
				\arrow["\varphi"', shift right=1, dashed, from=1-1, to=1-3]
				\arrow["{T\varphi}", shift left=1, dashed, from=1-1, to=1-3]
			\end{tikzcd}
			\longmapsto
			% file:///home/jsb20179/data/software/quiver/src/index.html?q=WzAsNixbMCwwLCJcXGxlbnN7VFN9e1N9Il0sWzAsMiwiXFxsZW5ze0l9e099Il0sWzIsMCwiXFxsZW5ze1RSfXtSfSJdLFsyLDIsIlxcbGVuc3tKfXtRfSJdLFswLDQsIlxcbGVuc3tJJ317Tyd9Il0sWzIsNCwiXFxsZW5ze0onfXtRJ30iXSxbMCwxLCJcXGV4cG9zZV97XFxzeXMgU30iLDIseyJsYWJlbF9wb3NpdGlvbiI6NDAsIm9mZnNldCI6MX1dLFsxLDAsIlxcdXBkYXRlX3tcXHN5cyBTfSIsMix7ImxhYmVsX3Bvc2l0aW9uIjo0MCwib2Zmc2V0IjoxfV0sWzIsMywiXFxleHBvc2Vfe1xcc3lzIFJ9IiwyLHsibGFiZWxfcG9zaXRpb24iOjQwLCJvZmZzZXQiOjF9XSxbMywyLCJcXHVwZGF0ZV97XFxzeXMgUn0iLDIseyJsYWJlbF9wb3NpdGlvbiI6NDAsIm9mZnNldCI6MX1dLFsxLDMsImgiLDIseyJvZmZzZXQiOjF9XSxbMSwzLCJoXlxcZmxhdCIsMCx7Im9mZnNldCI6LTF9XSxbMCwyLCJcXHZhcnBoaSIsMix7Im9mZnNldCI6MSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsMiwiVFxcdmFycGhpIiwwLHsib2Zmc2V0IjotMSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzEsNCwicF5cXHNoYXJwIiwyLHsibGFiZWxfcG9zaXRpb24iOjQwLCJvZmZzZXQiOjF9XSxbMyw1LCJxXlxcc2hhcnAiLDIseyJsYWJlbF9wb3NpdGlvbiI6NDAsIm9mZnNldCI6MX1dLFs0LDEsInAiLDIseyJsYWJlbF9wb3NpdGlvbiI6NDAsIm9mZnNldCI6MX1dLFs1LDMsInEiLDIseyJsYWJlbF9wb3NpdGlvbiI6NDAsIm9mZnNldCI6MX1dLFs0LDUsImteXFxmbGF0IiwwLHsib2Zmc2V0IjotMX1dLFs0LDUsImsiLDIseyJvZmZzZXQiOjF9XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\lens{TS}{S}} \&\& {\lens{TR}{R}} \\
				\\
				{\lens{I}{O}} \&\& {\lens{J}{Q}} \\
				\\
				{\lens{I'}{O'}} \&\& {\lens{J'}{Q'}}
				\arrow["{\expose_{\sys S}}"'{pos=0.4}, shift right=1, from=1-1, to=3-1]
				\arrow["{\update_{\sys S}}"'{pos=0.4}, shift right=1, from=3-1, to=1-1]
				\arrow["{\expose_{\sys R}}"'{pos=0.4}, shift right=1, from=1-3, to=3-3]
				\arrow["{\update_{\sys R}}"'{pos=0.4}, shift right=1, from=3-3, to=1-3]
				\arrow["h"', shift right=1, from=3-1, to=3-3]
				\arrow["{h^\flat}", shift left=1, from=3-1, to=3-3]
				\arrow["\varphi"', shift right=1, dashed, from=1-1, to=1-3]
				\arrow["T\varphi", shift left=1, dashed, from=1-1, to=1-3]
				\arrow["{p^\sharp}"'{pos=0.4}, shift right=1, from=3-1, to=5-1]
				\arrow["{q^\sharp}"'{pos=0.4}, shift right=1, from=3-3, to=5-3]
				\arrow["p"'{pos=0.4}, shift right=1, from=5-1, to=3-1]
				\arrow["q"'{pos=0.4}, shift right=1, from=5-3, to=3-3]
				\arrow["{k^\flat}", shift left=1, from=5-1, to=5-3]
				\arrow["k"', shift right=1, from=5-1, to=5-3]
			\end{tikzcd}
		\end{eqalign}
		We thus defined the \textbf{theory of $(F,T)$-generalized Moore machines}:
		\begin{equation}
			\Moore_{(F,T)} : \dblLens_F^\top \unilaxto \dblCat.
		\end{equation}
	\end{example}

	% \begin{remark}
	% 	There is a sense in which generalized Moore machines are `free theories' on their process theory. In fact most of a Moore machine is given by a plain $F$-lens. The only thing that distinguishes a Moore machine from any other lens is our insistence on considering its left boundary stateful, hence the choice of maps.

	% 	Thus one can define $\Moore_{(F,T)}$ `formally' by considering one `generator' $S$ for each object in $\cat C$ and let lenses act on them. The action
	% \end{remark}

	\begin{example}
		A notable example of generalized Moore machines is given by differential open dynamical systems.
		These are Moore machines in $\Smooth$, the category of smooth manifolds.\footnote{Sometimes it's useful to consider suitable generalizations, like diffeological or smooth spaces, to get better properties out of the theory. We don't go beyond undergraduate differential geometry here.} We consider bundles given by submersions,\footnote{A \emph{submersion} of smooth manifolds is a surjective smooth map whose differential is also surjective. It means we are mapping to a manifold of equal or smaller dimension, and all the fibers are manifolds themselves (hence excluding critial points or singular submanifolds).} since these are pullback-stable maps:
		\begin{eqalign}
			\Smooth/_{\sf subm} - : \Smooth^\op &\longto \Cat\\
			\begin{tikzcd}
				M \arrow{d}{p} \\ N
			\end{tikzcd}
			\qquad &\longmapsto
			% https://q.uiver.app/?q=WzAsNixbMCwwLCJcXFNtb290aC9fe1xcc2Ygc3VibX0gTSJdLFswLDEsIlxcU21vb3RoL197XFxzZiBzdWJtfSBOIl0sWzEsMSwiTiJdLFsyLDEsIkUiXSxbMSwwLCJNIl0sWzIsMCwicF4qRSJdLFsxLDAsInBeKiJdLFs0LDIsInAiLDJdLFszLDIsIlxccGkiXSxbNSw0XSxbNSwzXSxbNSwyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
			\begin{tikzcd}[ampersand replacement=\&]
				{\Smooth/_{\sf subm} M} \& M \& {p^*E} \\
				{\Smooth/_{\sf subm} N} \& N \& E
				\arrow["{p^*}", from=2-1, to=1-1]
				\arrow["p"', from=1-2, to=2-2]
				\arrow["\pi", from=2-3, to=2-2]
				\arrow[from=1-3, to=1-2]
				\arrow[from=1-3, to=2-3]
				\arrow["\lrcorner"{anchor=center, pos=0.125, rotate=-90}, draw=none, from=1-3, to=2-2]
			\end{tikzcd}
		\end{eqalign}
		We then choose the section $T : \Smooth \to \int \Smooth/_{\sf subm}$ to be the one picking out, for each smooth manifold $S$, its tangent bundle $\pi_S : TS \to S$. This extends to smooth maps $\varphi:S \to R$ by mapping them to their differential, which is indeed a map of tangent bundles $TS \to TR$.

		Then a Moore machine $\lens{\update}{\expose} : \lens{TS}{S} \opticto \lens{I}{O}$ is a pair of maps
		\begin{equation}
			\expose : S \to O, \quad \update : (s:S) \times (i:I(\expose(s))) \to T_s S
		\end{equation}
		which describe an observable on $S$ and a non-autonomous vector field on it:
		\begin{equation}
			\de s = \update(s, i)
		\end{equation}
		Notably, a system of this kind with a trivial interface is simply a vector field (i.e.~a section of the tangent bundle).
	\end{example}

	\begin{example}[Mealy machines]
		Similar to Moore machines are Mealy machines: they too are stateful open dynamical systems over a bidirectional interface $\lens{I}{O}$, but their output is also dependent on their input:
		\begin{equation}
			\expose : S \times I \to O, \qquad \update : S \times I \to S
		\end{equation}
		Therefore they are usually given as a single map
		\begin{equation}
			\delta : S \times I \longto S \times O
		\end{equation}
		in some cartesian monoidal category $(\cat C, 1, \times)$.

		This seemingly inconsequential difference makes Mealy machines quite different. In fact, contrary to Moore machines, such systems cannot be reindexed by lenses anymore $\lens{p^\sharp}{p} : \lens{I}{O} \opticto \lens{J}{Q}$ like Moore machines, the problem arising when reindexing the input:
		\begin{equation}
			\Mealy_{\cat C}\lens{p^\sharp}{p} : \delta \ \mapsto\  S \times J \nlongto{?} S \times I \nlongto{\delta} S \times O \nlongto{p} S \times Q
		\end{equation}
		In fact in order to use $p^\sharp$ to convert a $J$ to an $I$ we need to have $O$ in scope, but $O$ can be \emph{produced} only if $I$ is available! So we run into a vicious cycle.

		There's at least three ways to break this \emph{empasse}. The first is to remove the dependency on $O$ in $p^\sharp$. Hence instead of lenses we'll be looking at adapters, which are simply pairs of maps going in opposite directions.

		The second is to solve the circularity by using a trace (or a trace-like) operator, thus asking for the ambient category $\cat C$ to be a traced or a feedback category (as in \cite{katis1997bicategories, lavore2021canonical}). Then Mealy machines can be reindexed by morphisms in $\Int(\cat C)$, which are indeed quite similar to Mealy machines:
		\begin{equation}
			p : \lens{I}{O} \to \lens{J}{Q} \equiv J \times O \to I \times Q.
		\end{equation}
		These reindex $\delta$ by using the trace to get rid of extra $O$:
		\begin{equation}
			\Mealy_{\cat C}(p) : \delta \ \mapsto\  \mathsf{trace}_O(S \times J \times O \nlongto{S \times p} S \times I \times Q \nlongto{\delta \times Q} S \times O \times Q).
		\end{equation}
		They compose with each other similarly.

		The third option is to turn lenses `upside down'. Let a \emph{colens} in $\cat C$ $\lens{I}{O} \opticto \lens{J}{Q}$ be a pair of maps $p:J \to I$ and $p_\sharp : J \times O \to Q$. These compose like lenses and can reindex Mealy machines:\footnotemark
		\begin{equation}
			\Mealy_{\cat C}\lens{p}{p_\sharp} : \delta \ \mapsto\  S \times J \nlongto{\langle J, S \times p \rangle} J \times S \times I \nlongto{\delta \times J} J \times S \times O \nlongto{\langle S, p_\sharp \rangle} S \times Q
		\end{equation}

		All these options (when well-defined) admit suitably dual, chart-like morphisms that fit into double categories of `commutative squares', like the one in~\cref{ex:lenses}.
		This makes $\Mealy_{\cat C}$ a theory of systems:
		\begin{equation}
			\Mealy_{\cat C} : \dblcat{P}^\top \unilaxto \dblCat
		\end{equation}
		for $\dblcat{P} = \dblcat{Adap}(\cat C)$ (adapters \& pairs of morphisms), $\dblcat{Colens}_{\cat C}$ (colenses \& `cocharts'), $\dblcat{Int}(\cat C)$ ($\Int$-morphisms \& their duals). Clearly the latter is admissibile only when $\cat C$ is traced.

		\footnotetext{
		Both lenses and colenses embed in $\Int(\cat C)$ when the latter exists, and both trivialize the tracing because they present only non-trivial circularity.
		All of adapters, lenses, colenses and $\Int(\cat C)$ are categories of optics fit into a diamond:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNCxbMSwwLCJcXEludChcXGNhdCBDKSJdLFswLDEsIlxcY2F0e0NvbGVuc30oXFxjYXQgQykiXSxbMiwxLCJcXGNhdHtMZW5zfShcXGNhdCBDKSJdLFsxLDIsIlxcY2F0e0FkYXB9KFxcY2F0IEMpIl0sWzMsMV0sWzMsMl0sWzIsMF0sWzEsMF1d
			\begin{tikzcd}[ampersand replacement=\&,sep=tiny]
				\& {\Int(\cat C)} \\
				{\cat{Colens}(\cat C)} \&\& {\cat{Lens}(\cat C)} \\
				\& {\cat{Adap}(\cat C)}
				\arrow[from=3-2, to=2-1]
				\arrow[from=3-2, to=2-3]
				\arrow[from=2-3, to=1-2]
				\arrow[from=2-1, to=1-2]
			\end{tikzcd}
		\end{equation}
		Adapters, lenses and colenses are all instances of optics \cite{clarke_profunctor_2020} and recently $\Int(\cat C)$ was also shown to be a theory of optics (this was first noted in \cite{juleshedges_geometry_2023}, and then expanded upon in private communication between Hedges and Milewski).
		Thus we conjecture this diamond arises from relations between the actions generating the optics \cite{roman_profunctor_2020}.
		}
	\end{example}

	\begin{example}
		observational systems
	\end{example}

	\begin{example}
		structured cospans
	\end{example}

	\subsection{Doctrines}
	A doctrine of systems is a uniform way to specify theories of systems given some data.
	Most of the theories we described above are actually doctrines, since we defined them parametric on some data:
	\begin{enumerate}
		\item a theory of observational systems is defined for each Cartesian category $\cat C$,
		\item a theory of Moore machines is defined for every fibration $\pi : \cat E \to \cat C$ with a section $T$,
		\item a theory of coalgebras is defined for every category $\cat C$,
	\end{enumerate}
	and so on.

	\begin{definition}
		A \textbf{doctrine of systems} is a 2-functor into $\Theories$.
	\end{definition}

	The 2-category $\Theories$ has system theories as objects and the following as 1-cells:

	\begin{definition}
		A \textbf{map of system theories} is a pair $(F,F^\flat) : \Sys_1 \to \Sys_2$ where $F$ is a lax double functor while $F^\flat$ is a vertical lax-natural transformation.
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXFByb2Nlc3Nlc18xXlxcdG9wIl0sWzAsMiwiXFxQcm9jZXNzZXNfMl5cXHRvcCJdLFsyLDEsIlxcZGJsQ2F0Il0sWzEsMF0sWzEsMl0sWzAsMSwiRl5cXHRvcCIsMl0sWzAsMiwiXFxTeXNfMSIsMCx7ImN1cnZlIjotMX1dLFsxLDIsIlxcU3lzXzIiLDIseyJjdXJ2ZSI6MX1dLFszLDQsIkZeXFxmbGF0IiwwLHsib2Zmc2V0Ijo1LCJzaG9ydGVuIjp7InNvdXJjZSI6MzAsInRhcmdldCI6MzB9LCJsZXZlbCI6Mn1dXQ==
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\Processes_1^\top} \& {} \\
				\&\& \dblCat \\
				{\Processes_2^\top} \& {}
				\arrow["{F^\top}"', from=1-1, to=3-1]
				\arrow["{\Sys_1}", curve={height=-6pt}, from=1-1, to=2-3]
				\arrow["{\Sys_2}"', curve={height=6pt}, from=3-1, to=2-3]
				\arrow["{F^\flat}"', shift right=1, shorten <=15pt, shorten >=15pt, Rightarrow, from=1-2, to=3-2]
			\end{tikzcd}
		\end{equation}
	\end{definition}

	The 2-cells in $\Theories$ are pairs of an horizontal natural transformation and a modification \cite{grandis_higher_2019}.

	\section{Behaviours}
	Behaviours in CST are simply maps into an observational theory. By default, we consider behaviours valued in $\Obs(\Set)$, but one can consider `enriched behaviours' into $\Obs(\cat C)$ when one wants to keep track of extra structure on the set of behaviours of a system.

	\begin{definition}
		A \textbf{theory of behaviour} for a system theory $\Sys$ valued in the Cartesian category $\cat C$ is a map of system theories $B:\Sys \to \Obs(\cat C)$:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXFByb2Nlc3Nlc15cXHRvcCJdLFswLDIsIlxcU3BhbihcXGNhdCBDKV5cXHRvcCJdLFsyLDEsIlxcZGJsQ2F0Il0sWzEsMF0sWzEsMl0sWzAsMSwiQl5cXHRvcCIsMl0sWzAsMiwiXFxTeXMiLDAseyJjdXJ2ZSI6LTF9XSxbMSwyLCJcXGNhdCBDLy0iLDIseyJjdXJ2ZSI6MX1dLFszLDQsIkJeXFxmbGF0IiwwLHsib2Zmc2V0Ijo1LCJzaG9ydGVuIjp7InNvdXJjZSI6MzAsInRhcmdldCI6MzB9LCJsZXZlbCI6Mn1dXQ==
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\Processes^\top} \& {} \\
				\&\& \dblCat \\
				{\Span(\cat C)^\top} \& {}
				\arrow["{B^\top}"', from=1-1, to=3-1]
				\arrow["\Sys", curve={height=-6pt}, from=1-1, to=2-3]
				\arrow["{\cat C/-}"', curve={height=6pt}, from=3-1, to=2-3]
				\arrow["{B^\flat}"', shift right=4, shorten <=10pt, shorten >=15pt, Rightarrow, from=1-2, to=3-2]
			\end{tikzcd}
		\end{equation}
	\end{definition}

	\begin{example}[States]
		states of coalgebras, machines
	\end{example}

	\begin{example}[Fixpoints]
		fixpoints and equilibria
	\end{example}

	\begin{example}[Trajectories]
		integral curves of vector fields, traces of open dynamical systems
	\end{example}

	\begin{example}[Languages]
		One of the first notions of `behaviour of a system' one encounters in computer science is that of \emph{language of a finite states machines}. These, indeed, give a theory of behaviours for the theory of finite states machine we described in~\cref{ex:fsm}.

		Given an FSM $\sys S = (S, \Sigma, \delta, S^*)$, its language is the subset of $\Sigma^*$ given by those words which, when fed to $\sys S$, leave it in an accepting state (one in $S^*$). More precisely, we first have to pick an initial state $s_0 \in S$, then we can start using $\delta$, inputting the given word one character at a time, until we are done. Thus the language of an $\sys S$ is really a family of subsets of $\Sigma^*$, given by the recursively-defined map
		\begin{eqalign}
			L_{\sys S} : S &\longto P\Sigma^*\\
			s_0 &\longmapsto \{\sigma_1\cdots\sigma_n \suchthat \sigma_2\cdots\sigma_n \in L_{\sys S}(\delta(s_0, \sigma_1)) \}.
		\end{eqalign}
		Notice this family of subsets can also be defined as a `bundle of sets' (a map we use for its fibers)
		\begin{equation}
			\Lambda(\sys S) := \{ (s_0, w) \mid \in w \in L_{\sys S}(s_0) \} \monoto S \times \Sigma^* \nlongto{\pi_{\Sigma^*}} \Sigma^* \in \Set/\Sigma^*.
		\end{equation}
		Thus we see there is a theory of behaviour
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXEFscGheXFx0b3AiXSxbMCwyLCJcXFNwYW4oXFxTZXQpXlxcdG9wIl0sWzIsMSwiXFxkYmxDYXQiXSxbMSwwXSxbMSwyXSxbMCwxLCJ7KC0pXip9XlxcdG9wIiwyXSxbMCwyLCJcXEZTTSIsMCx7ImN1cnZlIjotMX1dLFsxLDIsIlxcU2V0Ly0iLDIseyJjdXJ2ZSI6MX1dLFszLDQsIkwiLDAseyJvZmZzZXQiOjUsInNob3J0ZW4iOnsic291cmNlIjozMCwidGFyZ2V0IjozMH0sImxldmVsIjoyfV1d
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\Alph^\top} \& {} \\
				\&\& \dblCat \\
				{\Span(\Set)^\top} \& {}
				\arrow["{{(-)^*}^\top}"', from=1-1, to=3-1]
				\arrow["\FSM", curve={height=-6pt}, from=1-1, to=2-3]
				\arrow["{\Set/-}"', curve={height=6pt}, from=3-1, to=2-3]
				\arrow["\Lambda", shift right=5, shorten <=10pt, shorten >=15pt, Rightarrow, from=1-2, to=3-2]
			\end{tikzcd}
		\end{equation}
		where
		\begin{enumerate}
			\item $(-)^* : \Alph \to \Span(\Set)$ sends a finite alphabet $\Sigma$ to the free monoid $\Sigma^*$, an alphabet mapping $h:\Sigma \to \Sigma'$ to the morphism of monoids $h^* : \Sigma^* \to {\Sigma'}^*$, an alphabet reduction $p: \Sigma \from \Xi$ to the span $\Sigma^* \nfrom{p^*} \Xi^* \equalto \Xi^*$, and a commutative square to an obvious morphism of spans.
			\item The component at $\Sigma : \Alph$ of $\Lambda$ is given by
			\begin{eqalign}
				L_\Sigma : \FSM(\Sigma) &\longto \Set/\Sigma^*\\
				(S, \Sigma, \delta, S^*) &\longmapsto \Lambda(\sys S) : \{ (s_0, w) \mid \in w \in L_{\sys S}(s_0) \} \to \Sigma^*
			\end{eqalign}
		\end{enumerate}

		The functoriality properties of these assignments can be proven by making the following observation. For each $n \in \N$ (including $0$), there are finite states machines $\sys{Fin\, n} = (\Fin\, n+1, \Fin\, n, \_+1, \{n\})$. Explicitly, these have $n+1$ states and are defined over an alphabet with $n$ symbols. The transition map is
		\begin{eqalign}
			\_ + 1 : \Fin\,n+1\ \times\ \Fin\, n &\longto \Fin\,n+1\\
			(k, i) &\longmapsto k+1
		\end{eqalign}
		and the only accepting state is $n \in \Fin\,n+1$.

		A map from this machine to another like $\sys S$, mediated by a map of alphabets $\sigma : \Fin\,n \to \Sigma$, looks like this:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNixbMCwwLCJcXEZpblxcLCBuKzEgXFx0aW1lcyBcXEZpblxcLG4iXSxbMCwyLCJcXEZpblxcLG4rMSJdLFsyLDAsIlMgXFx0aW1lcyBcXFNpZ21hIl0sWzIsMiwiUyJdLFsyLDMsIlNeKiJdLFswLDMsIlxce25cXH0iXSxbMiwzLCJcXGRlbHRhIiwyXSxbMCwxLCJcXF8rMSIsMl0sWzAsMiwicyJdLFsxLDMsIlxcc2lnbWEiXSxbNSw0LCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzUsMSwiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDMsIlxcc3Vic2V0ZXEiLDMseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\Fin\, n+1 \times \Fin\,n} \&\& {S \times \Sigma} \\
				\\
				{\Fin\,n+1} \&\& S \\
				{\{n\}} \&\& {S^*}
				\arrow["\delta"', from=1-3, to=3-3]
				\arrow["{\_+1}"', from=1-1, to=3-1]
				\arrow["s \times \sigma", from=1-1, to=1-3]
				\arrow["s", from=3-1, to=3-3]
				\arrow["\subseteq"{marking}, draw=none, from=4-1, to=4-3]
				\arrow["\subseteq"{marking}, draw=none, from=4-1, to=3-1]
				\arrow["\subseteq"{marking}, draw=none, from=4-3, to=3-3]
			\end{tikzcd}
		\end{equation}
		Concretely, this is a map $s: \Fin\,n+1 \to S$ selecting a sequence of $n+1$ states $s_0, \ldots, s_n$ such that
		\begin{equation}
			\forall 0 \leq k \leq n-1,\ s_{k+1} = \delta(s_k, \sigma_k) \quad\text{and}\quad s_n \in S^*.
		\end{equation}
		In other words, this data amounts to a word $\sigma_1 \cdots \sigma_n \in \Sigma^*$ and a state $s_0 \in S$ such that $\sys S$ accepts $\sigma_1 \cdots \sigma_n$ in $n$ steps when starting from $s_0$.

		Notice this also works for the empty word: a map from $\sys {Fin\, 0}$ is given by just a choice of state $s_0 \in S^*$, meaning $\sys S$ accepts the empty word when starting from $s_0$.

		Therefore we see $((-)^*, \Lambda)$ is a sum of corepresentable behaviours, namely $\sum_{n \geq 0} \FSM(\sys {Fin\, n}, -)$. Observe the symmetry restored: $(-)^*$ is also the functor $\sum_{n \geq 0} \Set(\Fin\, n, -)$!
	\end{example}

	\begin{definition}
		A \textbf{doctrine of behaviour} for the doctrine $\dblcat{Doctrine}$ is map of doctrines of systems into the observational doctrine $\Obs$:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXGRibGNhdHtEYXRhfSJdLFswLDIsIlxcZGJsY2F0e0NhcnRDYXR9Il0sWzIsMSwiXFxUaGVvcmllcyJdLFsxLDBdLFsxLDJdLFswLDEsIlxcZGJsY2F0IEJeXFx0b3AiLDJdLFswLDIsIlxcZGJsY2F0e0RvY3RyaW5lfSIsMCx7ImN1cnZlIjotMX1dLFsxLDIsIlxcT2JzIiwyLHsiY3VydmUiOjF9XSxbMyw0LCJcXGRibGNhdCBCXlxcZmxhdCIsMCx7Im9mZnNldCI6NSwic2hvcnRlbiI6eyJzb3VyY2UiOjMwLCJ0YXJnZXQiOjMwfSwibGV2ZWwiOjJ9XV0=
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\dblcat{Data}} \& {} \\
				\&\& \Theories \\
				{\dblcat{CartCat}} \& {}
				\arrow["{\dblcat B^\top}"', from=1-1, to=3-1]
				\arrow["{\dblcat{Doctrine}}", curve={height=-6pt}, from=1-1, to=2-3]
				\arrow["\Obs"', curve={height=6pt}, from=3-1, to=2-3]
				\arrow["{\dblcat B^\flat}"', shift right=3, shorten <=10pt, shorten >=14pt, Rightarrow, from=1-2, to=3-2]
			\end{tikzcd}
		\end{equation}
	\end{definition}

	\begin{remark}
		The laxity of $B^\flat$ relates the behaviours of the parts of a system to the behaviour of the whole system. The non-invertibility of such a map witnesses emergent behaviours.
		In \cite[Theorem 5.3.3.1]{myers_categorical_2022}, Myers proves that a large class of behaviours for the doctrine of Moore machines does not, in fact, exhibit emergence, by showing such the laxity of $B^\flat$ is invertible.
	\end{remark}

	\begin{example}
		A large class of behaviours are corepresentables, i.e.~defined by simulations of an archetypal system exhibiting that behaviour.
		Thus there is a \textbf{doctrine of corepresentable behaviour} on the doctrine of pointed theories:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNSxbMCwwLCJcXFRoZW9yaWVzX1xcYXN0Il0sWzAsMiwiXFxkYmxjYXR7Q2FydENhdH0iXSxbMiwxLCJcXFRoZW9yaWVzIl0sWzEsMF0sWzEsMl0sWzAsMSwiXFxTZXQiLDJdLFswLDIsIlUiLDAseyJjdXJ2ZSI6LTF9XSxbMSwyLCJcXE9icyIsMix7ImN1cnZlIjoxfV0sWzMsNCwiXFxIb21eaCIsMix7Im9mZnNldCI6Mywic2hvcnRlbiI6eyJzb3VyY2UiOjMwLCJ0YXJnZXQiOjMwfSwibGV2ZWwiOjJ9XV0=
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\Theories_\ast} \& {} \\
				\&\& \Theories \\
				{\dblcat{CartCat}} \& {}
				\arrow["\Set"', from=1-1, to=3-1]
				\arrow["U", curve={height=-6pt}, from=1-1, to=2-3]
				\arrow["\Obs"', curve={height=6pt}, from=3-1, to=2-3]
				\arrow["{\Hom^h}"', shift right=3, shorten <=10pt, shorten >=14pt, Rightarrow, from=1-2, to=3-2]
			\end{tikzcd}
		\end{equation}
		An object of $\Theories_\ast$ is a system theory equipped with a distinguished system (hence a pair of an interface and a system over it) which is used as archetype for a certain kind of behaviour.

		The transformation $\Hom^h$ at a pointed theory $(\Sys : \Processes^\top \to \dblCat, \sys B : \Sys(I))$ is the map of system theories $\Processes^h(\sys B, -) : \Sys \to \Obs(\Set)$ defined as follows.
		Its two components are the horizontal hom-functor $\Processes^h(I, -) : \Processes \to \dblSet$ and the similar fiberwise hom-functor
		\begin{equation}
			\Processes^h(\sys B, -)^\flat : \Sys \twoto \Set/\Processes^h(I, -).
		\end{equation}
		This latter functor sends a system $\sys S : \Sys(J)$ to the $\Processes^h(I, J)$-indexed family of sets sending a map of interfaces $k : I \to J$ to the set $\Sys(k)(\sys B, \sys S)$ of maps of systems mediated by $k$.
	\end{example}

	\begin{example}
		Let $\dblcat{MooreData}^!$ be the 2-category of fibrations of categories with a terminal object and a section thereof. These amount to a fibration $p:\cat E \to \cat C$ such that $p(1_{\cat E}) = 1_{\cat C}$, and a section $T : \cat C \to \cat E$ such that $T(1_{\cat C}) = 1_{\cat E}$.
		In this situation, one can build the Moore machine $\fix : \lens{T1}{1} \equalto \lens{1}{1}$ which `does nothing'. Hence we get a \emph{doctrine of fixpoints} by using such a machine as the archetype for the behaviour of a still system:
		\begin{equation}
			% https://q.uiver.app/?q=WzAsNixbMCwxLCJcXFRoZW9yaWVzX1xcYXN0Il0sWzAsMywiXFxkYmxjYXR7Q2FydENhdH0iXSxbMiwyLCJcXFRoZW9yaWVzIl0sWzEsMV0sWzEsM10sWzAsMCwiXFxkYmxjYXR7TW9vcmVEYXRhfV4xIl0sWzAsMSwiXFxTZXQiLDJdLFswLDIsIlUiLDAseyJjdXJ2ZSI6LTF9XSxbMSwyLCJcXE9icyIsMix7ImN1cnZlIjoxfV0sWzMsNCwiXFxIb21eaCIsMix7Im9mZnNldCI6Mywic2hvcnRlbiI6eyJzb3VyY2UiOjMwLCJ0YXJnZXQiOjMwfSwibGV2ZWwiOjJ9XSxbNSwyLCJcXE1vb3JlIiwwLHsiY3VydmUiOi0zfV0sWzUsMCwiKFxcTW9vcmUsIFxcZml4IDogXFxNb29yZSgxKSkiLDJdXQ==
			\begin{tikzcd}[ampersand replacement=\&, sep=small]
				{\dblcat{MooreData}^!} \\[2ex]
				{\Theories_\ast} \& {} \\
				\&\& \Theories \\
				{\dblcat{CartCat}} \& {}
				\arrow["\Set"', from=2-1, to=4-1]
				\arrow["U", curve={height=-6pt}, from=2-1, to=3-3]
				\arrow["\Obs"', curve={height=6pt}, from=4-1, to=3-3]
				\arrow["{\Hom^h}"', shift right=3, shorten <=10pt, shorten >=14pt, Rightarrow, from=2-2, to=4-2]
				\arrow["\Moore", curve={height=-18pt}, from=1-1, to=3-3]
				\arrow["{(\Moore,\ \fix : \Moore(1))}"', from=1-1, to=2-1]
			\end{tikzcd}
		\end{equation}
	\end{example}

	\printbibliography
\end{document}
